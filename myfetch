#!/usr/bin/env bash
ORANGE='\033[38;5;208m'
BLACK='\033[30m'
PURPLE='\033[35m'
RESET='\033[0m'

os_name=$(cat /etc/os-release 2>/dev/null | grep '^NAME=' | cut -d'"' -f2 || echo 'Linux')
os_version=$(cat /etc/os-release 2>/dev/null | grep '^VERSION=' | cut -d'"' -f2 || echo '')
os="$os_name${os_version:+ $os_version}"
kernel="$(uname -r)"
device="$(cat /sys/devices/virtual/dmi/id/product_name 2>/dev/null || echo 'Unknown')"
uptime="$(uptime -p | sed 's/up //')"
terminal="bash $(bash --version | head -n1 | cut -d' ' -f4 | tr -d ',')"
res_output=$(xrandr --query 2>/dev/null)
display_res=$(echo "$res_output" | grep " primary" | grep -oP '\d+x\d+' || echo "unknown")
display_res2=$(echo "$res_output" | grep " connected" | grep -v " primary" | grep -oP '\d+x\d+' | head -n1 || echo "")
cpu_info="$(lscpu | grep "Model name:" | cut -d':' -f2 | xargs) @ $(lscpu | grep "CPU MHz:" | awk '{printf "%.1f GHz", $3/1000}' || echo "unknown")"
gpu_info="Intel (integrated)"
ram_used=$(free -h | awk '/^Mem:/ {print $3}')
ram_total=$(free -h | awk '/^Mem:/ {print $2}')
ram="$ram_used / $ram_total"

lines=()
lines+=("${PURPLE}OS:${RESET} $os")
lines+=("${PURPLE}Kernel:${RESET} Linux $kernel")
lines+=("${PURPLE}Device:${RESET} $device")
lines+=("${PURPLE}Uptime:${RESET} $uptime")
lines+=("${PURPLE}Terminal:${RESET} $terminal")
lines+=("${PURPLE}Display-res:${RESET} $display_res")
[ -n "$display_res2" ] && lines+=("${PURPLE}Display-res2:${RESET} $display_res2")
lines+=("${PURPLE}CPU-info:${RESET} $cpu_info")
lines+=("${PURPLE}GPU-info:${RESET} $gpu_info")
lines+=("${PURPLE}Ram:${RESET} $ram")

max_len=0
for line in "${lines[@]}"; do
    # Strip ANSI escapes - need to handle both \033 and \e formats
    clean=$(echo -e "$line" | sed 's/\x1b\[[0-9;]*m//g')
    len=${#clean}
    (( len > max_len )) && max_len=$len
done

box_content_width=$max_len
box_inner_width=$((box_content_width + 2))
border=$(printf '─%.0s' $(seq 1 $box_inner_width))

distro_id=$(cat /etc/os-release 2>/dev/null | grep '^ID=' | cut -d'=' -f2 | tr -d '"')
distro_base=$(cat /etc/os-release 2>/dev/null | grep '^ID_LIKE=' | cut -d'=' -f2 | tr -d '"')

# proxmox detection
if command -v pveversion >/dev/null 2>&1; then
    distro_id="pve"
    distro_base="debian"
fi

if [ "$distro_id" = "pve" ]; then
    os_name="Proxmox VE"
    os="$os_name"
fi

# asciis

case "$distro_id" in
    pve)
        read -r -d '' ascii <<"EOF"
    ${BLACK}@@@@.      @@@@${RESET}           
 ${ORANGE}+++.${BLACK}@@@@@   @@@@@${ORANGE}.+++${RESET}        
${ORANGE}.+++++ ${BLACK}@@@@@@@@@ ${ORANGE}+++++.${RESET}       
  ${ORANGE}++++++ ${BLACK}@@@@@ ${ORANGE}++++++${RESET}         
    ${ORANGE}+++++..${BLACK}@${ORANGE}..+++++${RESET}           
      ${ORANGE}+++++ +++++.${RESET}            
   ${ORANGE}.+++++ ${BLACK}@@@ ${ORANGE}+++++.${RESET}          
  ${ORANGE}+++++. ${BLACK}@@@@@ ${ORANGE}.+++++${RESET}         
${ORANGE}=+++++ ${BLACK}@@@@@@@@@ ${ORANGE}++++++${RESET}       
 ${ORANGE}... ${BLACK}@@@@@   @@@@@  ${ORANGE}..${RESET}        
    ${BLACK}@@@@       @@@@${RESET}          
EOF
        ;;
    arch|endeavouros|manjaro|garuda)
        read -r -d '' ascii <<'EOF'
                   -`
                  .o+`
                 `ooo/
                `+oooo:
               `+oooooo:
               -+oooooo+:
             `/:-:++oooo+:
            `/++++/+++++++:
           `/++++++++++++++:
          `/+++ooooooooooooo/`
         ./ooosssso++osssssso+`
        .oossssso-````/ossssss+`
       -osssssso.      :ssssssso.
      :osssssss/        osssso+++.
     /ossssssss/        +ssssooo/-
   `/ossssso+/:-        -:/+osssso+-
  `+sso+:-`                 `.-/+oso:
 `++:.                           `-/+/
 .`                                 `

EOF
        ;;
    ubuntu)
        read -r -d '' ascii <<'EOF'

              ===========
          ===================
        =======================
      =================     =====
     ==========       =     ======
    ========= -=        ===========
   ========    .=======.    ========
  ========    ===========    ========
  ====   =   =============   :=======
  ===     =  ========================
  ====   =   =============   :=======
  ========    ===========    ========
   ========    .=======:    ========
    ========= -=        ===========
     ==========       =     ======
      =================     =====
        =======================
          ===================
              ===========


EOF
        ;;
    linuxmint)
        read -r -d '' ascii <<'EOF'

         .                   .
            ===============
         =====================
   .   =========================   .
      ===...=====================
 .   ====...=====.....=.....======   .
    =====...===...............=====
   ======...===...===...===...======
   ======...===...===...===...======
   ======...===...===...===...======
   ======...===...===...===...======
   ======...===...===...===...======
    =====...===============...=====
 .   =====...................=====   .
      ======...............======
   .   =========================
         =====================
            ===============
         .                   .


EOF
        ;;
    pop)
        read -r -d '' ascii <<'EOF'

            .++++++++++++*..
         .++++++++++++++*****.
       .+++.........++*********.
      +++.....+-.....+***********
     ++++.....+++.....************
    ++++++.....+**....***....******
   .+++++++.....*=...+**.....******.
   +++++++++........****....********
   ++++++++**.....******...*********
   ++++++*****....******..**********
   .+++********....****************.
    +***********....***..**********
     *****************************
      *****.................*****
       .***.................***.
         .*******************.
           ..*************..



EOF
        ;;
    cachyos)
        read -r -d '' ascii <<'EOF'


        **++++++++++++++++*
       =++++*+++++++++++++
      ==+++==++*+++++++++      =--
     ===++++====++++++++
    ====+++++++++++++++
   =====++++                +++
  ===+++*++                =====
 +++++++*+                  ---
========*
 ===++++++                       ++++++
  +*+++++++                      ======
   +++***+++=                    =----
     +++++===+++================
      ++++==+++++*+============
       +++=+++++++++++========
        +++++++++++++++++====
         +++++++++++++++++++



EOF
        ;;
    void)
        read -r -d '' ascii <<'EOF'
                -------
              -----------
               -----------
            *   --   ------
            **         ----
           ****    -    ----
         @@****@@*++=-@@#+++@@
         @@@**@@@%+@@=@@@@+#@@
          @@%%@@@=-@@#@@@%-#@@
          @@#* @@*%@+@@@@%#@@@
           **** @*=--*@@%++=
           ****    -    ----
            ****         --
            ******    *   -
             ***********
              ***********
                *******

EOF
        ;;
    *)
        # Check if based on a supported distro
        case "$distro_base" in
            *arch*)
                read -r -d '' ascii <<'EOF'
                   -`
                  .o+`
                 `ooo/
                `+oooo:
               `+oooooo:
               -+oooooo+:
             `/:-:++oooo+:
            `/++++/+++++++:
           `/++++++++++++++:
          `/+++ooooooooooooo/`
         ./ooosssso++osssssso+`
        .oossssso-````/ossssss+`
       -osssssso.      :ssssssso.
      :osssssss/        osssso+++.
     /ossssssss/        +ssssooo/-
   `/ossssso+/:-        -:/+osssso+-
  `+sso+:-`                 `.-/+oso:
 `++:.                           `-/+/
 .`                                 `

EOF
                ;;
            *ubuntu*|*debian*)
                read -r -d '' ascii <<'EOF'

              ===========
          ===================
        =======================
      =================     =====
     ==========       =     ======
    ========= -=        ===========
   ========    .=======.    ========
  ========    ===========    ========
  ====   =   =============   :=======
  ===     =  ========================
  ====   =   =============   :=======
  ========    ===========    ========
   ========    .=======:    ========
    ========= -=        ===========
     ==========       =     ======
      =================     =====
        =======================
          ===================
              ===========

EOF
                ;;
            *fedora*|*rhelfedora*)
                read -r -d '' ascii <<'EOF'

             ###########             
         ###################         
      ################    #####      
    ##############          **###    
   ##############          ****###   
  ##############    #######*****###  
 ##############    #########*****### 
 ##############    #########*****### 
###############    #########****#####
###############     #####******######
#####*****               *****#######
####******              ***##########
###****########    ################# 
##****#########    ################# 
##****#########    ################  
##*****########    ###############   
###******###.     ###############    
#####**          ##############      
#######*      ##############         
  ######################             

EOF
                ;;
            *)
                # Fallback for completely unknown distros
                read -r -d '' ascii <<'EOF'
         _nnnn_
        dGGGGMMb
       @p~qp~~qMb
       M|@||@) M|
       @,----.JM|
      JS^\__/  qKL
     dZP        qKRb
    dZP          qKKb
   fZP            SMMb
   HZM            MMMM
   FqM            MMMM
 __| ".        |\dS"qML
 |    `.       | `' \Zq
_)      \.___.,|     .'
\____   )MMMMMP|   .'
     `-'       `--'

EOF
                ;;
        esac
        ;;
esac

mapfile -t ascii_arr <<< "$ascii"
# === Print side-by-side ===
box_height=$((${#lines[@]} + 2))  # +2 for top and bottom borders

for (( i=0; i < ${#ascii_arr[@]}; i++ )); do
    # Left side: ASCII
    left="${ascii_arr[i]}"

    # Right side: box content (only for the first box_height lines)
    right=""
    if (( i < box_height )); then
        if (( i == 0 )); then
            right="╭${border}╮"
        elif (( i == box_height - 1 )); then
            right="╰${border}╯"
        else
            idx=$((i - 1))
            content="${lines[idx]}"
            # Strip colors for length calculation - use same method as above
            clean_content=$(echo -e "$content" | sed 's/\x1b\[[0-9;]*m//g')
            content_len=${#clean_content}
            # Total padding needed after content
            total_padding=$((box_content_width - content_len))
            # Build the line character by character to ensure alignment
            right="│ "
            right+="${content}"
            for (( p=0; p<total_padding; p++ )); do
                right+=" "
            done
            right+=" │"
        fi
    fi

    # Combine and print the full line
    printf "%-40s" "$left"
    echo -en "$right"
    echo
done
echo ""
